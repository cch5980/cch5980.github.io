# ReactJS-17 리덕스 활용

- 리액트 애플리케이션에서 리덕스를 사용할 때는 store 인스턴스를 직접 사용하기보다는 주로 react-redux 라는 라이브러리에서 제공하는 유틸 함수(connect) 와 컴포넌트(Provider) 를 사용한다. 



## 🔥1. 작업 환경 설정

```bash
$ yarn create react-app react-redux-tutorial
$ cd react-redux-tutorial
$ yarn add redux react-redux
```



## 🔥2. UI 준비하기

- 리덕스를 사용할 때 가장 많이 사용하는 패턴: 프레젠테이셔널 컴포넌트와 컨테이너 컴포넌트를 분리
  - 프레젠테이셔널 컴포넌트: 주로 상태관리가 이루어지지 않고, 그저 props를 받아 와서 화면에 UI를 보여주기만 하는 컴포넌트
  - 컨테이너 컴포넌트: 리덕스와 연동되어 있는 컴포넌트, 리덕스로부터 상태를 받아오기도 하고 리덕스 스토어에 액션을 디스패치하기도 한다.
- 이번 프로젝트에서는 이 패턴을 사용
  - UI 관련된 프레젠테이셔널 컴포넌트: src/components
  - 리덕스와 연동된 컨테이너 컴포넌트: src/containers



### 2-1) 카운터 컴포넌트

- 숫자를 더하고 뺄 수 있는 카운터 컴포넌트

```react
// src/components/Counter.js
import React from 'react';

const Counter = ({ number, onIncrease, onDecrease }) => {
    return (
        <div>
            <h1>{number}</h1>
            <div>
                <button onClick={onIncrease}>+1</button>
                <button onClick={onDecrease}>-1</button>
            </div>
        </div>
    );
};

export default Counter;
```

```react
// src/App.js
import React from 'react';
import Counter from './components/Counter';

const App = () => {
  return (
    <div>
      <Counter number={0} />
    </div>
  );
};

export default App;
```

![reactjs-17-01](md-images/reactjs-17-01.JPG)



### 2-2) 할 일 목록 컴포넌트 만들기

- 해야 할 일을 추가하고, 체크하고, 삭제할 수 있는 할 일 목록 컴포넌트

```react
// src/components/Todos.js
import React from 'react';

const TodoItem = ({ todo, onToggle, onRemove }) => {
    return  (
        <div>
            <input type="checkbox" />
            <span>예제 테스트</span>
            <button>삭제</button>
        </div>
    );
};

const Todos = ({
    input,
    todos,
    onChangeInput,
    onInsert,
    onToggle,
    onRemove,
}) => {
    const onSubmit = e => {
        e.preventDefualt();
    };
    return (
        <div>
            <form onSubmit={onSubmit}>
                <input />
                <button type="submit">등록</button>
            </form>
            <TodoItem />
            <TodoItem />
            <TodoItem />
            <TodoItem />
            <TodoItem />
        </div>
    );
};

export default Todos;
```

```react
// src/App.js
...
import Todos from './components/Todos';

const App = () => {
  return (
    <div>
      <Counter number={0} />
      <hr />
      <Todos />
    </div>
  );
};

export default App;
```

![reactjs-17-02](md-images/reactjs-17-02.JPG)



## 🔥3. 리덕스 관련 코드 작성

- 리덕스를 사용할 때는 `액션 타입`, `액션 생성 함수`, `리듀서` 코드를 작성해야 한다.
- 이 코드들을 각각 다른 파일에 작성하는 방법이 있고, 기능별로 묶어서 파일 하나에 작성하는 방법이 있다.
  1. ![reactjs-17-03](md-images/reactjs-17-03.JPG)
     - actions, constants, reducers 라는 세 개의 디렉토리를 만들고 그 안에 기능별로 파일을 하나씩 만드는 방식
     - 코드를 종류에 따라 다른 파일에 작성하고 정리할 수 있어서 편리하다.
     - 새로운 액션을 만들 때마다 세 종류의 파일을 모두 수정해야 하기 때문에 불편하다.
  2. ![reactjs-17-04](md-images/reactjs-17-04.JPG)
     - **Ducks 패턴**
     - 액션 타입, 액션 생성 함수, 리듀서 함수를 기능별로 파일 하나에 몰아서 다 작성하는 방식



### 3-1) counter 모듈 작성

- Ducks 패턴을 사용하여 `액션 타입`, `액션 생성 함수`, `리듀서`를 작성한 코드를 '**모듈**' 이라고 한다.



#### 3-1-1) 액션 타입 정의

- 가장 먼저 해야 할 작업은 액션 타입을 정의하는 것
- 액션 타입은 대문자로 작성
- 문자열 내용은 '모듈 이름/액션 이름' 과 같은 형태로 작성
- 문자열 안에 모듈 이름을 넣음으로써, 나중에 프로젝트가 커졌을 때 액션의 이름이 충돌되지 않는다.

```react
// src/modules/counter.js
const INCREASE = 'counter/INCREASE';
const DECREASE = 'counter/DECREASE';
```



#### 3-1-2) 액션 생성 함수 만들기

```react
// src/modules/counter.js
...

export const increase = () => ({ type: INCREASE });
export const decrease = () => ({ type: DECREASE });
```

- 여기서 `export` 라는 키워드 사용
- 추후 이 함수를 다른 파일에서 불러와 사용할 수 있다.



#### 3-1-3) 초기 상태 및 리듀서 함수 만들기

```react
// src/modules/counter.js
...

const initialState = {
    number: 0
};

function counter(state = initialState, action) {
    switch (action.type) {
        case INCREASE:
            return {
                number: state.number + 1
            };
        case DECREASE:
            return {
                number: state.number - 1
            };
        default:
            return state;
    }
}

export default counter;
```

- 모듈의 초기 상태에는 number 값을 설정해준다.

- 리듀서 함수에는 현재 상태를 참조하여 새로운 객체를 생성해서 반환하는 코드를 작성해준다.

- `export default` 키워드를 사용하여 함수를 내보내 준다.

  - `export`는 여러 개를 내보낼 수 있고, `export default`는 단 한 개만 내보낼 수 있다.

  - ```react
    // 불러오는 방식도 다르다.
    import counter from './counter'
    import { increase, decrease } from './counter';
    // 한꺼번에 불러오고 싶을 때
    import counter, { increase, decrease } from './counter';
    ```



### 3-2) todos 모듈 만들기



#### 3-2-1) 액션 타입 정의

```react
// src/modules/todos.js
const CHANGE_INPUT = 'todos/CHANGE_INPUT';  // 인풋 값을 변경함
const INSERT = 'todos/INSERT';  // 새로운 todo를 등록함
const TOGGLE = 'todos/TOGGLE';  // todo를 체크/체크 해제함
const REMOVE = 'todos/REMOVE';  // todo를 제거함
```



#### 3-2-2) 액션 생성 함수 만들기

```react
// src/modules/todos.js
...

export const changeInput = input => ({
    type: CHANGE_INPUT,
    input
});

let id = 3; // insert가 호출될 때마다 1씩 더해진다.
export const insert = text => ({
    type: INSERT,
    todo: {
        id: id++,
        text,
        done: false
    }
});

export const toggle = id => ({
    type: TOGGLE,
    id
});

export const remove = id => ({
    type: REMOVE,
    id
});
```

- 여기서 id 값이 3인 이유는 초기 상태를 작성할 때 todo 객체 두 개를 사전에 미리 넣어둘 것이기 때문이다.



#### 3-2-3) 초기 상태 및 리듀서 함수 만들기

```react
// src/modules/todos.js
...

const initialState = {
    input: '',
    todos: [
        {
            id: 1,
            text: '리덕스 기초 배우기',
            done: true
        },
        {
            id: 2,
            text: '리액트와 리덕스 사용하기',
            done: false
        }
    ]
};

function todos(state = initialState, action) {
    switch (action.type) {
        case CHANGE_INPUT:
            return {
                ...state,
                input: action.input
            };
        case INSERT:
            return {
                ...state,
                todos: state.todos.concat(action.todo)
            };
        case TOGGLE:
            return {
                ...state,
                todos: state.todos.map(todo =>
                    todo.id === action.id ? { ...todo, done: !todo.done } : todo      
                )
            };
        case REMOVE:
            return {
                ...state,
                todos: state.todos.filter(todo => todo.id !== action.id)
            };
        default:
            return state;
    }
}

export default todos;
```



### 3-3) 루트 리듀서 만들기

- 이번 프로젝트에서는 리듀서를 여러개 만들었지만, 나중에 `createStore` 함수를 사용하여 **스토어를 만들 때는 리듀서를 하나만 사용해야 한다.**
- 기존에 만들었던 리듀서를 하나로 합쳐주어야 하는데, 리덕스에서 제공하는 `combineReducers` 라는 유틸 함수를 사용한다.

```react
// src/modules/index.js
import { combineReducers } from 'redux';
import counter from './counter';
import todos from './todos';

const rootReducer = combineReducers({
    counter,
    todos,
});

export default rootReducer;
```

- 파일 이름을 index.js 로 설정해 주면 나중에 불러올 때 디렉토리 이름까지만 입력하여 불러올 수 있다.

- ```react
  import rootReducer from './modules';
  ```





## 🔥4. 리액트 애플리케이션에 리덕스 적용

- 스토어를 만들고 리액트 애플리케이션에 리덕스를 적용하는 작업은 src 디렉토리의 index.js 에서 이루어진다.



### 4-1) 스토어 만들기

```react
// src/index.js
...
import { createStore } from 'redux';
import rootReducer from './modules';

const store = createStore(rootReducer);

...
```



### 4-2) Provider 컴포넌트를 사용하여 프로젝트에 리덕스 적용

- 리액트 컴포넌트에서 스토어를 사용할 수 있도록 **App 컴포넌트**를 react-redux에서 제공하는 **Provider 컴포넌트**로 감싸준다.
- 이 컴포넌트를 사용할 때는 store를 **props로 전달해 주어야 한다**.

```react
// src/index.js
...
import { createStore } from 'redux';
import rootReducer from './modules';
import { Provider } from 'react-redux';

const store = createStore(rootReducer);

ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root')
);
```



### 4-3) Redux DevTools 의 설치 및 적용

- [Redux DevTools](https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=ko&) 라는 리덕스 개발자 도구 설치(크롬 확장 프로그램)

- 코드의 가독성을 위해 패키지 설치

  - ```bash
    $ yarn add redux-devtools-extension
    ```

```react
// src/index.js
...
import { composeWithDevTools } from 'redux-devtools-extension';

const store = createStore(rootReducer, composeWithDevTools());

...
```

![reactjs-17-05](md-images/reactjs-17-05.JPG)



## 🔥5. 컨테이너 컴포넌트 만들기

- 컴포넌트에서 리덕스 스토어에 접근하여 원하는 상태를 받아 오고, 액션도 디스패치할 예정이다.
- 리덕스 스토어와 연동된 컴포넌트를 컨테이너 컴포넌트라고 부른다.



### 5-1) CounterContainer 만들기

```react
// src/containers/CounterContainer.js
import React from 'react';
import Counter from '../components/Counter';

const CounterContainer = () => {
    return <Counter />;
};

export default CounterContainer;
```

- 위 컴포넌트를 리덕스와 연동하려면 react-redux에서 제공하는 `connect` 함수를 사용해야 한다.



- `connect(mapStateToProps, mapDispatchToProps) (연동할 컴포넌트)`

  - `mapStateToProps` 는 리덕스 **스토어 안의 상태를 컴포넌트의 props로 넘겨주기 위해** 설정하는 함수

  - `mapDispatchToProps`는 **액션 생성 함수를 컴포넌트의 props로 넘겨주기 위해** 사용하는 함수

  - 이렇게 `connect` 함수를 호출하고 나면 **또 다른 함수를 반환**

  - 반환된 함수에 <u>컴포넌트를 파라미터로 넣어주면 리덕스와 연동된 컴포넌트가 된다.</u>

  - ```react
    const makeContainer = connect(mapStateToProps, mapDispatchToProps)
    makeContainer(타겟 컴포넌트)
    ```

```react
import React from 'react';
import Counter from '../components/Counter';
import { connect } from 'react-redux';

const CounterContainer = ({ number, increase, decrease }) => {
    return <Counter number={number} onIncrease={increase} onDecrease={decrease} />;
};

const mapStateToProps = state => ({
    number: state.counter.number,
});
const mapDispatchToProps = dispatch => ({
    // 임시 함수
    increase: () => {
        console.log('increase');
    },
    decrease: () => {
        console.log('decrease');
    },
});

export default connect(
    mapStateToProps,
    mapDispatchToProps,
)(CounterContainer);
```



